<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نمودار قیمت بیت کوین</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tahoma&display=swap');
        body {
            font-family: 'Tahoma', sans-serif;
        }
        .card {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .price-up {
            animation: pulseGreen 2s infinite;
        }
        .price-down {
            animation: pulseRed 2s infinite;
        }
        @keyframes pulseGreen {
            0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        @keyframes pulseRed {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
    </style>
</head>
<body style="background-color:#0090ff" class="bg-gray-100">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div class="flex items-center">
                <i class="fab fa-bitcoin text-yellow-500 text-4xl mr-3"></i>
                <h1 class="text-3xl font-bold text-gray-800">نمودار قیمت بیت کوین</h1>
            </div>
            
            <div class="flex items-center gap-4">
                <div id="currentPrice" class="bg-white rounded-lg p-4 shadow-md flex items-center price-up">
                    <span id="btcPrice" class="text-2xl font-bold ml-2">$0.00</span>
                    <span id="priceChange" class="text-sm px-2 py-1 rounded-full bg-green-100 text-green-800 flex items-center">
                        <i class="fas fa-arrow-up ml-1"></i> 0.00%
                    </span>
                </div>
                
                <select id="timeframe" class="bg-white border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    <option value="1">1 روز</option>
                    <option value="7">7 روز</option>
                    <option value="30" selected>1 ماه</option>
                    <option value="90">3 ماه</option>
                    <option value="365">1 سال</option>
                </select>
            </div>
        </div>

        <div class="card bg-white rounded-xl p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-700">تغییرات قیمت</h2>
                <div class="flex gap-2">
                    <button class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition">
                        <i class="fas fa-download ml-1"></i> ذخیره
                    </button>
                    <button class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-share-alt ml-1"></i> اشتراک
                    </button>
                </div>
            </div>
            
            <div class="relative h-96">
                <canvas id="btcChart"></canvas>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="card bg-white rounded-xl p-6 flex flex-col">
                <h3 class="text-lg font-medium text-gray-700 mb-4">حداکثر قیمت 24 ساعته</h3>
                <div class="flex items-center justify-between">
                    <span id="dailyHigh" class="text-2xl font-bold text-green-600">$00,000.00</span>
                    <i class="fas fa-arrow-up text-green-500 text-xl"></i>
                </div>
            </div>
            
            <div class="card bg-white rounded-xl p-6 flex flex-col">
                <h3 class="text-lg font-medium text-gray-700 mb-4">حداقل قیمت 24 ساعته</h3>
                <div class="flex items-center justify-between">
                    <span id="dailyLow" class="text-2xl font-bold text-red-600">$00,000.00</span>
                    <i class="fas fa-arrow-down text-red-500 text-xl"></i>
                </div>
            </div>
            
            <div class="card bg-white rounded-xl p-6 flex flex-col">
                <h3 class="text-lg font-medium text-gray-700 mb-4">حجم معاملات 24h</h3>
                <div class="flex items-center justify-between">
                    <span id="dailyVolume" class="text-2xl font-bold text-blue-600">$00,000.00</span>
                    <i class="fas fa-exchange-alt text-blue-500 text-xl"></i>
                </div>
            </div>
        </div>
        
        <div class="card bg-white rounded-xl p-6">
            <h3 class="text-lg font-medium text-gray-700 mb-4">اطلاعات بیشتر</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-6 py-3 text-right">زمان</th>
                            <th class="px-6 py-3 text-right">قیمت</th>
                            <th class="px-6 py-3 text-right">تغییرات</th>
                            <th class="px-6 py-3 text-right">حجم (BTC)</th>
                            <th class="px-6 py-3 text-right">حجم (USD)</th>
                        </tr>
                    </thead>
                    <tbody id="priceHistory" class="divide-y divide-gray-200">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get DOM elements
            const timeframeSelect = document.getElementById('timeframe');
            const btcPriceElement = document.getElementById('btcPrice');
            const priceChangeElement = document.getElementById('priceChange');
            const priceCard = document.getElementById('currentPrice');
            const dailyHighElement = document.getElementById('dailyHigh');
            const dailyLowElement = document.getElementById('dailyLow');
            const dailyVolumeElement = document.getElementById('dailyVolume');
            const priceHistoryTable = document.getElementById('priceHistory');
            
            let btcChart;
            let currentPrice = 0;
            
            // Initialize chart
            function initChart() {
                const ctx = document.getElementById('btcChart').getContext('2d');
                btcChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'قیمت بیت کوین (USD)',
                            data: [],
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                rtl: true,
                                labels: {
                                    font: {
                                        family: 'Tahoma'
                                    }
                                }
                            },
                            tooltip: {
                                rtl: true,
                                bodyFont: {
                                    family: 'Tahoma'
                                },
                                titleFont: {
                                    family: 'Tahoma'
                                },
                                callbacks: {
                                    label: function(context) {
                                        return 'قیمت: $' + context.parsed.y.toLocaleString('en-US');
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    font: {
                                        family: 'Tahoma'
                                    }
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                ticks: {
                                    font: {
                                        family: 'Tahoma'
                                    },
                                    callback: function(value) {
                                        return '$' + value.toLocaleString('en-US');
                                    }
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
            }
            
            // Format price
            function formatPrice(price) {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(price);
            }
            
            // Format large numbers
            function formatLargeNumber(num) {
                if (num >= 1000000000) {
                    return (num / 1000000000).toFixed(2) + 'B';
                }
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(2) + 'M';
                }
                if (num >= 1000) {
                    return (num / 1000).toFixed(2) + 'K';
                }
                return num.toString();
            }
            
            // Update price card animation
            function updatePriceCardAnimation(changePercent) {
                priceCard.classList.remove('price-up', 'price-down');
                if (changePercent > 0) {
                    priceCard.classList.add('price-up');
                } else if (changePercent < 0) {
                    priceCard.classList.add('price-down');
                }
            }
            
            // Fetch Bitcoin price data from CoinGecko API
            async function fetchBitcoinData(days = 30) {
                try {
                    const response = await fetch(`https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=${days}`);
                    const data = await response.json();
                    
                    // Process price data for chart
                    const prices = data.prices;
                    const labels = prices.map(priceData => {
                        const date = new Date(priceData[0]);
                        if (days <= 1) {
                            return date.toLocaleTimeString('fa-IR');
                        } else if (days <= 30) {
                            return date.toLocaleDateString('fa-IR', { month: 'short', day: 'numeric' });
                        } else {
                            return date.toLocaleDateString('fa-IR', { month: 'short', year: 'numeric' });
                        }
                    });
                    
                    const priceValues = prices.map(priceData => priceData[1]);
                    
                    // Update chart
                    btcChart.data.labels = labels;
                    btcChart.data.datasets[0].data = priceValues;
                    btcChart.update();
                    
                    // Update current price
                    if (priceValues.length > 0) {
                        currentPrice = priceValues[priceValues.length - 1];
                        const prevPrice = priceValues[Math.max(0, priceValues.length - 2)];
                        const changePercent = ((currentPrice - prevPrice) / prevPrice) * 100;
                        
                        btcPriceElement.textContent = formatPrice(currentPrice);
                        priceChangeElement.innerHTML = `
                            <i class="fas ${changePercent >= 0 ? 'fa-arrow-up' : 'fa-arrow-down'} ml-1"></i> ${Math.abs(changePercent).toFixed(2)}%
                        `;
                        
                        if (changePercent >= 0) {
                            priceChangeElement.classList.remove('bg-red-100', 'text-red-800');
                            priceChangeElement.classList.add('bg-green-100', 'text-green-800');
                        } else {
                            priceChangeElement.classList.remove('bg-green-100', 'text-green-800');
                            priceChangeElement.classList.add('bg-red-100', 'text-red-800');
                        }
                        
                        updatePriceCardAnimation(changePercent);
                    }
                    
                    // Fetch additional market data
                    const marketResponse = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin');
                    const marketData = await marketResponse.json();
                    
                    // Update market data
                    dailyHighElement.textContent = formatPrice(marketData.market_data.high_24h.usd);
                    dailyLowElement.textContent = formatPrice(marketData.market_data.low_24h.usd);
                    dailyVolumeElement.textContent = formatPrice(marketData.market_data.total_volume.usd);
                    
                    // Update price history table (mock data)
                    updatePriceHistoryTable();
                    
                } catch (error) {
                    console.error('Error fetching Bitcoin data:', error);
                    alert('خطا در دریافت داده‌های بیت‌کوین. لطفاً اینترنت خود را بررسی کنید.');
                }
            }
            
            // Update price history table with mock data
            function updatePriceHistoryTable() {
                // Generate mock data (in a real app, you would get this from the API)
                const now = new Date();
                const historyData = [];
                
                for (let i = 0; i < 5; i++) {
                    const time = new Date(now.getTime() - i * 3600000);
                    const price = currentPrice * (1 + (Math.random() * 0.02 - 0.01)); // Random price change ±1%
                    const change = (price - currentPrice) / currentPrice * 100;
                    const btcVolume = Math.random() * 1000;
                    const usdVolume = btcVolume * price;
                    
                    historyData.push({
                        time: time.toLocaleTimeString('fa-IR'),
                        price: formatPrice(price),
                        change: change.toFixed(2) + '%',
                        btcVolume: btcVolume.toFixed(2),
                        usdVolume: formatPrice(usdVolume)
                    });
                }
                
                // Populate table
                priceHistoryTable.innerHTML = historyData.map(item => `
                    <tr>
                        <td class="px-6 py-4">${item.time}</td>
                        <td class="px-6 py-4">${item.price}</td>
                        <td class="px-6 py-4 ${item.change.startsWith('-') ? 'text-red-600' : 'text-green-600'}">
                            ${item.change}
                        </td>
                        <td class="px-6 py-4">${item.btcVolume}</td>
                        <td class="px-6 py-4">${item.usdVolume}</td>
                    </tr>
                `).join('');
            }
            
            // Initialize and load data
            initChart();
            fetchBitcoinData();
            
            // Handle timeframe changes
            timeframeSelect.addEventListener('change', function() {
                fetchBitcoinData(this.value);
            });
            
            // Update price every 30 seconds (simulated with random changes)
            setInterval(() => {
                // This is just for demo - in a real app you would fetch the latest price
                const changeFactor = (Math.random() * 0.02 - 0.01); // Random change between -1% and +1%
                const newPrice = currentPrice * (1 + changeFactor);
                const percentChange = (changeFactor * 100).toFixed(2);
                
                btcPriceElement.textContent = formatPrice(newPrice);
                priceChangeElement.innerHTML = `
                    <i class="fas ${changeFactor >= 0 ? 'fa-arrow-up' : 'fa-arrow-down'} ml-1"></i> ${Math.abs(percentChange)}%
                `;
                
                if (changeFactor >= 0) {
                    priceChangeElement.classList.remove('bg-red-100', 'text-red-800');
                    priceChangeElement.classList.add('bg-green-100', 'text-green-800');
                } else {
                    priceChangeElement.classList.remove('bg-green-100', 'text-green-800');
                    priceChangeElement.classList.add('bg-red-100', 'text-red-800');
                }
                
                updatePriceCardAnimation(parseFloat(percentChange));
                
                // Update the last point in the chart
                if (btcChart.data.datasets[0].data.length > 0) {
                    btcChart.data.datasets[0].data[btcChart.data.datasets[0].data.length - 1] = newPrice;
                    btcChart.update();
                }
            }, 30000);
        });
    </script>
</body>
</html>
